<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>Tugas Bahasa - PortofolioKu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet"/>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Scroll reveal animation */
        .reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .reveal.active {
            opacity: 1;
            transform: translateY(0);
        }
        /* Gaya tambahan untuk bagian Matematika */
        .formula-box {
            background-color: #f5f3ff;
            border-left: 4px solid #6366f1;
        }
        .simulasi-dialog {
            background-color: #f0fdf4;
            border: 1px solid #34d399;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .dialog-box {
            background-color: white;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            min-height: 4rem;
            position: relative; /* Untuk positioning karakter */
        }
        .options-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        .option-button {
            background-color: #e0f2fe;
            color: #065f46;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .option-button:hover {
            background-color: #34d399;
            color: white;
        }
        .feedback {
            background-color: #fef08a;
            border: 1px solid #fde047;
            border-radius: 0.375rem;
            padding: 1rem;
            margin-bottom: 1rem;
            text-align: center;
            font-weight: bold;
        }
        .hidden {
            display: none;
        }
        /* Gaya untuk karakter animasi */
        .character {
            position: absolute;
            left: 1rem;
            bottom: 0;
            height: 6rem; /* Sesuaikan tinggi karakter */
            animation: talk 0.8s infinite; /* Mulai animasi */
        }
        @keyframes talk {
            0% { transform: scaleY(1); }
            50% { transform: scaleY(0.8); }
            100% { transform: scaleY(1); }
        }
        /* Gaya untuk input suara */
        .input-suara {
            border: 2px solid #6b7280;
            border-radius: 0.375rem;
            padding: 0.75rem;
            width: 100%;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .input-suara input {
            flex: 1;
            border: none;
            outline: none;
        }
        .input-suara button {
            background-color: #4f46e5;
            color: white;
            padding: 0.5rem;
            border-radius: 9999px; /* Rounded button */
            cursor: pointer;
            transition: background-color 0.3s ease;
            border: none;
            box-shadow: 0 0 5px #4f46e5;
        }
        .input-suara button:hover {
            background-color: #4338ca;
        }
        .score-display {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background-color: #f0fdf4;
            color: #15803d;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: bold;
            border: 2px solid #16a34a;
        }
    </style>
</head>
<body class="bg-gray-100">
    <header class="fixed w-full bg-white shadow-md z-50">
        <nav class="container mx-auto flex items-center justify-between p-4 md:p-6">
            <a class="text-2xl font-bold text-indigo-600 hover:text-indigo-700 transition" href="index.html">
                PortofolioKu
            </a>
            <ul class="hidden md:flex space-x-8 text-lg font-medium">
                <li><a class="hover:text-indigo-600 transition" href="index.html#home">Home</a></li>
                <li><a class="hover:text-indigo-600 transition" href="index.html#about">About</a></li>
                <li><a class="hover:text-indigo-600 transition" href="matematika.html">Matematika</a></li>
                <li><a class="hover:text-indigo-600 transition" href="bahasa.html">Bahasa</a></li>
                <li><a class="hover:text-indigo-600 transition" href="index.html#tugas">Tugas</a></li>
                <li><a class="hover:text-indigo-600 transition" href="index.html#kontak">Kontak</a></li>
            </ul>
            <button class="md:hidden focus:outline-none" id="menu-btn">
                <i class="fas fa-bars text-2xl text-indigo-600"></i>
            </button>
        </nav>
        <div class="hidden md:hidden bg-white shadow-md" id="mobile-menu">
            <ul class="flex flex-col p-4 space-y-4 text-lg font-medium">
                <li><a class="block hover:text-indigo-600 transition" href="index.html#home">Home</a></li>
                <li><a class="block hover:text-indigo-600 transition" href="index.html#about">About</a></li>
                <li><a class="block hover:text-indigo-600 transition" href="matematika.html">Matematika</a></li>
                <li><a class="block hover:text-indigo-600 transition" href="bahasa.html">Bahasa</a></li>
                <li><a class="block hover:text-indigo-600 transition" href="index.html#tugas">Tugas</a></li>
                <li><a class="block hover:text-indigo-600 transition" href="index.html#kontak">Kontak</a></li>
            </ul>
        </div>
    </header>

    <main class="pt-20 pb-10 container mx-auto px-4">
        <section class="py-16" id="puisi">
            <h2 class="text-3xl font-bold text-indigo-700 mb-8 text-center reveal">Analisis Puisi</h2>
            <div class="bg-white rounded-lg shadow-md p-6 mb-4 reveal">
                <h4 class="text-xl font-semibold text-indigo-600 mb-2">Puisi "Aku"</h4>
                <p class="text-gray-700 mb-4">
                    Aku ini...<br>
                    Berdiri di sini<br>
                    Menatap langit biru<br>
                    Merasakan angin berlalu
                </p>
                <p class="text-gray-700">
                    Apa makna puisi ini bagimu? Tuliskan analisis Anda di bawah ini!
                </p>
                <textarea id="analisis-puisi" placeholder="Tuliskan analisis Anda di sini..." class="w-full p-2 border rounded-md h-32 mt-4"></textarea>
                <button onclick="submitAnalisis()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-full transition duration-300 mt-4">
                    Submit Analisis
                </button>
                <div id="feedback-puisi" class="mt-4 p-4 bg-yellow-100 border border-yellow-400 text-yellow-700 rounded relative hidden" role="alert">
                    <strong class="font-bold">Perhatian!</strong>
                    <span class="block sm:inline"></span>
                </div>
            </div>
        </section>

        <section class="py-16" id="dialog">
            <h2 class="text-3xl font-bold text-indigo-700 mb-8 text-center reveal">Simulasi Dialog Interaktif</h2>
            <div class="simulasi-dialog reveal">
                <div class="dialog-box">
                    <img src="images/character.png" alt="Karakter" class="character">
                    <div id="dialog-box" class="relative"></div>
                    <div class="score-display" id="score-display">Skor: 0</div>
                </div>
                <div class="options-container" id="options-container"></div>
                <div id="feedback" class="feedback hidden"></div>
                <div class="input-suara">
                    <input type="text" id="input-suara" placeholder="Ketik jawaban Anda atau gunakan suara...">
                    <button id="start-suara"><i class="fas fa-microphone"></i></button>
                </div>
            </div>
        </section>
    </main>

    <script>
        // Fungsi untuk menampilkan feedback (sama seperti sebelumnya)
        function showFeedback(message, type = 'warning') {
            const feedbackElement = document.getElementById('feedback-puisi'); // Pastikan ID sesuai
            feedbackElement.textContent = message;
            feedbackElement.className = `mt-4 p-4 rounded relative ${
                type === 'success'
                    ? 'bg-green-100 border border-green-400 text-green-700'
                    : type === 'warning'
                    ? 'bg-yellow-100 border border-yellow-400 text-yellow-700'
                    : 'bg-red-100 border border-red-400 text-red-700'
            }`;
            feedbackElement.classList.remove('hidden');
        }

        function submitAnalisis() {
            const analisisInput = document.getElementById('analisis-puisi').value.trim();
            if (analisisInput === '') {
                showFeedback('Tuliskan analisis Anda terlebih dahulu.');
            } else {
                showFeedback('Terima kasih atas analisis Anda!', 'success');
                // Di sini, Anda bisa mengirim data analisis ke server atau melakukan hal lain
            }
        }

        // --- Bagian Dialog Interaktif ---
        const dialogBox = document.getElementById('dialog-box');
        const optionsContainer = document.getElementById('options-container');
        const feedback = document.getElementById('feedback');  // Pastikan ID sesuai dengan HTML
        const scoreDisplay = document.getElementById('score-display');
        const inputSuaraInput = document.getElementById('input-suara');
        const startSuaraButton = document.getElementById('start-suara');

        let score = 0;
        let recognition;
        let speaking = false; // Untuk cek apakah karakter sedang bicara
        let currentDialog = 0; // Tambahkan inisialisasi currentDialog

        // Data dialog (sama seperti sebelumnya, tapi dengan tambahan scoring)
        const dialogData = [
            {
                text: "Selamat datang! Saya adalah teman dialogmu. Siap belajar Bahasa Indonesia?",
                options: [
                    { text: "Siap!", next: 1, score: 5 },
                    { text: "Belum siap.", next: undefined, score: 0 },
                ],
            },
            {
                text: "Bagus! Pertanyaan pertama: Apa sinonim dari kata 'bahagia'?",
                options: [
                    { text: "Senang", next: 2, score: 10 },
                    { text: "Sedih", next: undefined, score: 0 },
                    { text: "Marah", next: undefined, score: 0 },
                ],
            },
            {
                text: "Benar sekali! Sinonim dari 'bahagia' adalah 'senang'. Pertanyaan kedua: Apa lawan kata dari 'besar'?",
                options: [
                    { text: "Kecil", next: 3, score: 10 },
                    { text: "Luas", next: undefined, score: 0 },
                    { text: "Raksasa", next: undefined, score: 0 },
                ],
            },
            {
                text: "Tepat! Lawan kata dari 'besar' adalah 'kecil'. Sekarang, coba jawab pertanyaan ini dengan suara Anda: Siapa nama presiden pertama Indonesia?",
                options: [], // Tidak ada opsi, input via suara
                correctAnswer: "Soekarno", // Jawaban benar untuk input suara
            },
             {
                text: "Oke, pertanyaan terakhir. Pilih kata yang tepat untuk melengkapi kalimat ini: 'Ibu ... nasi di dapur.'",
                options: [
                    { text: "Memasak", next: undefined, score: 10 },
                    { text: "Makan", next: undefined, score: 0 },
                    { text: "Tidur", next: undefined, score: 0 },
                ],
                correctAnswer: "Memasak",
            },
        ];



        function showDialog() {
            const current = dialogData[currentDialog];
            if (!current) {
                endDialog(); // Panggil endDialog jika current undefined
                return;
            }

            dialogBox.textContent = current.text;
            optionsContainer.innerHTML = '';
            feedback.classList.add('hidden');
            inputSuaraInput.classList.toggle('hidden', current.options.length > 0);
            startSuaraButton.classList.toggle('hidden', current.options.length > 0);

             // Tambahkan animasi bicara jika karakter sedang bicara
            if (speaking) {
                dialogBox.classList.add('talking');
            } else {
                dialogBox.classList.remove('talking');
            }

            if (current.options.length > 0) {
                current.options.forEach((option) => {
                    const button = document.createElement('button');
                    button.textContent = option.text;
                    button.className =
                        'bg-indigo-500 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-md transition duration-300 option-button';
                    button.addEventListener('click', () => {
                        score += option.score;
                        scoreDisplay.textContent = `Skor: ${score}`;
                        currentDialog = option.next;
                        if (currentDialog === undefined) {
                            endDialog();
                        } else {
                            showDialog();
                        }
                    });
                    optionsContainer.appendChild(button);
                });
            }  else {
                inputSuaraInput.value = ''; //kosongkan input
            }
        }

        function endDialog() {
            feedback.textContent = `Dialog selesai! Skor Anda: ${score}. Terima kasih sudah belajar!`;
            feedback.classList.remove('hidden');
            dialogBox.textContent = '';
            optionsContainer.innerHTML = '';
            inputSuaraInput.classList.add('hidden');
            startSuaraButton.classList.add('hidden');
            speaking = false;
            // Simpan skor ke localStorage
            localStorage.setItem('skorBahasa', score);
        }

        // --- Web Speech API ---
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.lang = 'id-ID';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            recognition.onstart = () => {
                speaking = true;
                showDialog(); //update dialog
                startSuaraButton.classList.add('bg-red-500');
            };

            recognition.onend = () => {
                speaking = false;
                showDialog();
                startSuaraButton.classList.remove('bg-red-500');
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript.trim();
                inputSuaraInput.value = transcript;
                validateInput(transcript);
            };

            recognition.onerror = (event) => {
                console.error('Error:', event.error);
                feedback.textContent = `Terjadi kesalahan: ${event.error}`;
                feedback.classList.remove('hidden');
                speaking = false;
                showDialog();
                startSuaraButton.classList.remove('bg-red-500');
            };

            startSuaraButton.addEventListener('click', () => {
                if (speaking) {
                    recognition.stop();
                } else {
                    recognition.start();
                }
            });
        } else {
            inputSuaraInput.disabled = true;
            startSuaraButton.disabled = true;
            feedback.textContent = 'Fitur suara tidak didukung di browser ini.';
            feedback.classList.remove('hidden');
        }

        function validateInput(input) {
            const current = dialogData[currentDialog];
             if (!current) {
                return; //hentikan jika tidak ada dialog
             }
            if (current.correctAnswer) {
                if (input.toLowerCase().includes(current.correctAnswer.toLowerCase())) {
                    score += 10;
                    scoreDisplay.textContent = `Skor: ${score}`;
                    feedback.textContent = 'Benar!';
                    feedback.classList.remove('hidden');
                    setTimeout(() => {
                        currentDialog++;
                        if (currentDialog === undefined) {
                            endDialog();
                        } else {
                            showDialog();
                        }
                    }, 2000);
                } else {
                    feedback.textContent = 'Maaf, jawaban Anda kurang tepat. Silakan coba lagi.';
                    feedback.classList.remove('hidden');
                }
            } else if (current.options.length > 0){
                 const selectedOption = current.options.find(option =>
                    input.toLowerCase().includes(option.text.toLowerCase())
                );

                if (selectedOption) {
                    score += selectedOption.score;
                    scoreDisplay.textContent = `Skor: ${score}`;
                    currentDialog = selectedOption.next;
                    if (currentDialog === undefined) {
                         endDialog();
                    } else {
                         showDialog();
                    }
                }
                else {
                     feedback.textContent = 'Maaf, jawaban Anda tidak sesuai dengan pilihan yang ada. Silakan coba lagi.';
                     feedback.classList.remove('hidden');
                }

            }
            else {
                feedback.textContent = 'Maaf, tidak ada pilihan jawaban untuk pertanyaan ini. Silakan coba lagi.';
                feedback.classList.remove('hidden');
            }
        }

        inputSuaraInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                validateInput(inputSuaraInput.value.trim());
            }
        });

        // Load skor dari localStorage
        const savedScore = localStorage.getItem('skorBahasa');
        if (savedScore) {
            score = parseInt(savedScore, 10);
            scoreDisplay.textContent = `Skor: ${score}`;
        }

        showDialog(); // Mulai dialog
    </script>
</body>
</html>
